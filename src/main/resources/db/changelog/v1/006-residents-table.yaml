databaseChangeLog:
  - changeSet:
      id: create-users-table
      author: Shispon
      preConditions:
          - onFail: MARK_RAN
          - not:
                tableExists:
                    tableName: residents
                    schemaName: diplom
      changes:
        - sql:
            sql:
                CREATE TABLE diplom.residents (
                id int primary key generated by default as identity,
                first_name TEXT NOT NULL,
                second_name TEXT NOT NULL,
                last_name TEXT NOT NULL,
                age DATE NOT NULL,
                phone_number TEXT NOT NULL unique,
                mail TEXT NOT NULL unique,
                telegram_id TEXT not null,
                chat_id TEXT,
                photo OID,
                qr_code OID,
                is_present BOOLEAN NOT NULL DEFAULT FALSE,
                is_deleted BOOLEAN DEFAULT FALSE,
                date_created TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
                date_deleted TIMESTAMP,
                date_present TIMESTAMP,
                date_missing TIMESTAMP,
                role_id INT NOT NULL,
                group_id INT
              );
            dbms: postgresql

        - sql:
            sql:
                ALTER TABLE diplom.residents
                ADD CONSTRAINT fk_role FOREIGN KEY (role_id) REFERENCES diplom.roles(id);


                ALTER TABLE diplom.residents
                ADD CONSTRAINT fk_group FOREIGN KEY (group_id) REFERENCES diplom.groups(id);
            dbms: postgresql